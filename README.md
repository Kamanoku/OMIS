# Интеллектуальная система распознавания лиц для контроля доступа и безопасности (Лабораторная работа №6)



Кроссплатформенное десктопное приложение на базе **Python**, использующее современные нейросетевые архитектуры для биометрической идентификации личностей в реальном времени. Проект демонстрирует принципы чистого кода, разделение зон ответственности и интеграцию компьютерного зрения с реляционными базами данных.

---

##  Описание проекта

Программный комплекс предназначен для обеспечения безопасности на объектах с контрольно-пропускным режимом. Система автоматизирует аутентификацию сотрудников, ведет аудит посещений и мгновенно реагирует на попытки несанкционированного доступа.

### Ключевые возможности:
* **Биометрический анализ:** Высокоточное извлечение признаков лица с помощью нейросетей.
* **Интеллектуальная блокировка:** Автоматическое ограничение доступа при обнаружении посторонних лиц после заданного количества попыток.
* **Кириллическая поддержка:** Отрисовка статусов доступа на русском языке в видеопотоке.
* **Управление инцидентами:** Сохранение фото нарушителей и инструменты для оперативного реагирования (вызов ГБР, экстренный блок).
* **Аналитический дашборд:** Визуализация статистики проходов с использованием интерактивных графиков.

---

##  Архитектура системы

Проект реализован в соответствии с **многослойной архитектурой** и паттерном **MVC**.



* **Model**: Чистые структуры данных для сотрудников и отчетов об инцидентах.
* **Infrastructure**: Уровень взаимодействия с «железом» (FaceNet, SQLite).
* **Controllers**: Бизнес-логика идентификации и регистрации персонала.
* **Views**: Абстрактные интерфейсы отображения на базе **Tkinter**.

---

##  Основные модули

### 1. Ядро биометрии (`FaceRecognitionEngine`)
* **Детекция:** Библиотека **MTCNN** локализует лицо даже при наличии очков или препятствий.
* **Эмбеддинги:** Модель **InceptionResnetV1 (FaceNet)** преобразует лицо в уникальный вектор признаков.
* **Сравнение:** Расчет евклидова расстояния для верификации личности.

### 2. Слой доступа к данным (`DatabaseManager`)
* Реализован как **Singleton** для предотвращения конфликтов.
* **Хранение BLOB:** Векторы лиц и оригинальные фото сотрудников хранятся прямо в БД SQLite.
* **Динамические настройки:** Изменение порогов точности и времени блокировки «на лету».

### 3. Логика управления (`Controllers`)
* **PersonController:** Создание анкет, связка текстовых данных с биометрическим шаблоном.
* **AccessController:** Сопоставление "один-ко-многим" (1-to-N) для идентификации по видеопотоку.

### 4. Графический интерфейс (`Application`)
* **TextRenderer:** Наложение сглаженного кириллического текста на кадры OpenCV через Pillow.
* **Grid Cam System:** Имитация многоканального видеонаблюдения (сетка 2x2).

---

##  Роли пользователей

| Роль | Возможности |
| :--- | :--- |
| **Администратор** | Полный контроль БД, редактирование анкет, настройка чувствительности алгоритма. |
| **Оператор** | Мониторинг камер, работа с тревогами, просмотр фото нарушителей, вызов охраны. |
| **Руководство** | Просмотр статистики за периоды, настройка глобальных политик безопасности. |

## Быстрый старт

1. Убедитесь, что у вас установлен Python 3.12 или выше. Установите необходимые библиотеки для работы нейросетей, обработки видео и построения графиков.

```bash
pip install torch torchvision facenet-pytorch opencv-python pillow matplotlib
```

2. Запустите основной файл приложения.
   
```bash
python main.py
```

## Предустановленные аккаунты:
Для быстрой демонстрации возможностей системы при первом запуске предусмотрены следующие учетные записи (Login / Password).

Администратор: 
Login: admin 
Password: 123 

Оператор: 
Login: operator 
Password: 123 

Руководство: 
Login: boss 
Password: 123 

## Предустановленные данные
При самом первом запуске система автоматически создает базу данных security_system.db и наполняет её начальными настройками:

Порог распознавания: 85%

Лимит попыток до тревоги: 5

Авто-блокировка: 10 минут

Экстренная блокировка: 60 минут

(для более лучшей проверки рекомендуется выставить параметры 85%, 10, 1 минута и 2 минуты соответственно)


## Структура репозитория
```
lab6/
├─ controllers.py       # Бизнес-логика: управление персоналом и контроль доступа
├─ infrastructure.py    # Инфраструктура: работа с SQLite и нейросетевой движок
├─ main.py              # Точка входа: инициализация компонентов и GUI (Tkinter)
├─ model.py             # Модели данных: сущности сотрудников и отчетов
├─ views.py             # Представление: отрисовка текста и интерфейсы окон
├─ security_system.db   # Локальная база данных SQLite (создается автоматически)
└─ .venv/               # Виртуальное окружение с зависимостями (PyTorch, OpenCV)
```


##  Алгоритм работы

1.  **Захват:** Камера передает кадр в систему.
2.  **Анализ:** `AccessController` запрашивает векторы у `FaceEngine`.
3.  **Решение:** При совпадении с эталоном с учетом `threshold` — статус `GRANTED`.
4.  **Блокировка:** Если «Неизвестный» обнаружен $N$ раз подряд, система переходит в режим `LOCKED`, сохраняет фото в таблицу `incidents` и блокирует распознавание.
5.  **Логирование:** Запись каждой попытки в `access_log`.



---

##  Разделы интерфейса

### 1. Авторизация и доступ
* **Единое окно входа:** Централизованная точка доступа для всех сотрудников службы безопасности.
* **Ролевая модель:** Интерфейс динамически адаптируется под права пользователя (**Администратор**, **Оператор** или **Руководство**), скрывая или открывая специфические модули.
* **Безопасность:** Проверка учетных данных осуществляется через зашифрованные запросы к локальной БД SQLite.

> <img width="1826" height="925" alt="image" src="https://github.com/user-attachments/assets/f64d76b3-5c24-45ca-8897-ec8b920f9b96" />


---

### 2. Мониторинг в реальном времени (Окно оператора)
* **Сетка камер:** Имитация многоканального наблюдения (2х2). Основной поток транслируется с активного устройства, остальные каналы находятся в режиме ожидания.
* **Интеллектуальный рендеринг:** Наложение статусов прямо на видеопоток. 
    *  `[Имя]: доступ разрешен`
    *  `Unknown: доступ запрещен`
* **Живой журнал:** Динамический список последних 10 событий с метками времени в нижней части экрана.

> <img width="1898" height="985" alt="image" src="https://github.com/user-attachments/assets/32ef8cb5-ecfa-4dfd-a88e-38d0e9b0486f" />


---

### 3. Управление инцидентами и тревогами
* **Автоматическая фиксация:** При превышении лимита неудачных попыток система делает «снимок» лица нарушителя и заносит его в лог тревог.
* **Визуальный аудит:** Выбор строки в списке инцидентов мгновенно подгружает фото подозреваемого в правую панель (500x375 пикселей).
* **Экстренное реагирование:** Горячие кнопки для вызова ГБР или активации режима полной блокировки СКУД.

> <img width="1905" height="882" alt="image" src="https://github.com/user-attachments/assets/f5446a32-c970-43f3-bd76-9df21a4b90c4" />


---

### 4. База данных персонала (Окно администратора)
* **Реестр сотрудников:** Таблица с автоматической порядковой нумерацией и быстрым поиском по ФИО.
* **Интерактивный предпросмотр:** При выборе сотрудника в списке система отображает его эталонное фото из базы.
* **Управление данными:** Возможность редактирования должностей, отделов и удаления профилей вместе с их биометрическими эмбеддингами.

> <img width="1904" height="810" alt="image" src="https://github.com/user-attachments/assets/b27e3f3b-b507-461c-89cd-05caa02d0e67" />


---

### 5. Регистрация и редактирование биометрии
* **Гибкий импорт:** Добавление фото через проводник или создание мгновенного снимка с веб-камеры (клавиша `Space`).
* **Настройка доступа:** Выбор одного из 4-х уровней допуска и привязка к структурному подразделению.
* **Пересчет векторов:** При смене фотографии система автоматически обновляет нейросетевой шаблон сотрудника для точности узнавания.

> <img width="1904" height="542" alt="image" src="https://github.com/user-attachments/assets/20a2cdb1-0601-45e9-a203-ef93861ec47e" />
> <img width="558" height="554" alt="image" src="https://github.com/user-attachments/assets/094ee48c-3040-41cf-9807-f7adb1ebe5d2" />


---

### 6. Отчетность и аналитика (Окно руководства)
* **Карточки КПЭ:** Суммарные счетчики по категориям: «Всего», «Успешно», «Отказы».
* **Временные фильтры:** Формирование выборки за произвольный период работы.
* **Визуализация данных:** Столбчатая диаграмма активности посещений по часам, построенная через **Matplotlib**.

> <img width="1904" height="656" alt="image" src="https://github.com/user-attachments/assets/649d36d6-a9e6-47d3-863b-ddfd0aa3f26c" />


---

### 7. Настройки системы и политики безопасности
* **Конфигурация нейросети:** Регулировка порога точности (`Threshold`) для корректной работы при разном освещении.
* **Политики безопасности:**
    * Порог точности распознавания лица. 
    * Лимит попыток до срабатывания тревоги.
    * Таймер автоматической блокировки при нарушении.
    * Длительность режима «Паника» (экстренный блок).

> <img width="1897" height="301" alt="image" src="https://github.com/user-attachments/assets/7464de67-c97a-4b67-b80e-418e49a1cb9f" />
> <img width="1899" height="483" alt="image" src="https://github.com/user-attachments/assets/3625b960-5b0a-47a5-8d20-a0336d0247bc" />


---

##  Технологический стек

* **Язык программирования:** Python 3.12+
* **Нейросети:** PyTorch, facenet-pytorch (MTCNN + InceptionResnetV1) - Извлечение признаков, детекция, выравнивание и фреймворк глубокого обучения.
* **CV:** OpenCV, Pillow - Захват и первичная обработка потока, рендеринг и работа с графическими форматами.
* **БД:** SQLite - База данных.
* **GUI:** Tkinter (ttk), Matplotlib (графики)

---

##  Перспективы развития (Roadmap)
- [ ] Снизить коэффициент ложного отказа в доступе **(False Rejection Rate, FRR)** на 25% в условиях слабой освещенности (ниже 50 люкс) и при частичном перекрытии лица (медицинская маска, очки, головной убор).
- [ ] Обеспечить соответствие системы стандарту ISO/IEC 30107-3 по обнаружению атак-предъявлений **(Presentation Attack Detection)**, исключив возможность прохода по фотографии, видео с экрана или с использованием 3D-маски.
